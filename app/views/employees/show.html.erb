<% if notice %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= notice %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>
<%# Employee Information Card %>
<div class="card mb-4">
  <div class="card-header bg-light ">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="card-title mb-0 fw-bold"><%= @employee.name %>'s Details</h4>
      <span><%= link_to "Back to Employees", employees_path, class: "btn btn-sm btn-outline-secondary" %></span>
    </div>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <table class="table table-borderless">
          <tr>
            <th class="text-muted">Employee Number:</th>
            <td class="fw-bold"><%= @employee.id %></td>
          </tr>
          <tr>
            <th class="text-muted">Basic Salary:</th>
            <td><%= number_to_currency(@employee.salary, unit: "SAR ") %></td>
          </tr>
          <tr>
            <th class="text-muted">Allowance:</th>
            <td><%= number_to_currency(@employee.allowance, unit: "SAR ") %></td>
          </tr>
          <tr>
            <th class="text-muted">Total Salary:</th>
            <td><%= number_to_currency(@employee.gross_salary, unit: "SAR ") %></td>
          </tr>
          <tr>
            <th class="text-muted">Total Overtime:</th>
            <td><%= number_to_currency(@employee.overtime_value, unit: "SAR ") %></td>
          </tr>
        </table>
      </div>
      <div class="col-md-6">
        <table class="table table-borderless">
          <tr>
            <th class="text-muted">Net Salary:</th>
            <td class="fw-bold"><%= number_to_currency(@employee.total_salary, unit: "SAR ") %></td>
          </tr>
          
          <tr>
            <th class="text-muted">Total Debits</th>
            <td><%= number_to_currency(@employee.total_debits, unit: "SAR ") %></td>
          </tr>
          <tr>
            <tr>
            <th class="text-muted">Salary + Overtime</th>
            <td><%= number_to_currency(@employee.overtime_salary, unit: "SAR ") %></td>
          </tr>
          <tr>
            <th class="text-muted">Joined:</th>
            <td><%= @employee.created_at.strftime("%B %d, %Y") %></td>
          </tr>
          <tr>
            <th class="text-muted">Comment:</th>
            <td><%= @employee.comment %></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
<%# Add New Debit Card %>
<div class="card mb-4">
  <div class="card-header">
    <h4 class="card-title mb-0">Add New Debit</h4>
  </div>
  <div class="card-body">
    <%= form_with(model: [@employee, Debit.new], local: true, class: "row g-3") do |f| %>
      <div class="col-md-6">
        <%= f.label :amount, class: "form-label" %>
        <div class="input-group">
          <span class="input-group-text">SAR</span>
          <%= f.number_field :amount, step: :any, class: "form-control", placeholder: "Enter amount" %>
        </div>
      </div>
      <div class="col-12">
        <%= f.label :description, class: "form-label" %>
        <%= f.text_area :description, class: "form-control", rows: 3, placeholder: "Enter description" %>
      </div>
      <div class="col-12">
        <%= f.submit 'Add Debit', class: "btn btn-sm btn-outline-primary" %>
      </div>
    <% end %>
  </div>
</div>
<%# Debit History Card %>
<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h4 class="card-title mb-0">Debit History</h4>
    <span class="badge badge-pill bg-info">Total: <%= number_to_currency(@employee.debits.sum(:amount), unit: "SAR ") %></span>
  </div>
  <div class="card-body">
    <% if @employee.debits.any? %>
      <div class="row">
        <% @employee.debits.each do |debit| %>
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title"><%= number_to_currency(debit.amount, unit: "SAR ") %></h5>
                <p class="card-text"><%= debit.description %></p>
                <small class="text-muted">Added on: <%= debit.created_at&.strftime("%B %d, %Y") || "Date not available" %>
                  <% if debit.updated_at != debit.created_at %><br>
                    Updated on: <%= debit.updated_at.strftime("%B %d, %Y") || "Date not available"  %>
                  <% end %></small>
                <div class="d-flex gap-2 mt-2">
                  <%= link_to 'Edit', edit_employee_debit_path(@employee, debit), 
                      class: "btn btn-sm btn-outline-primary" %>
                  <%= button_to 'Delete', employee_debit_path(@employee, debit), 
                      method: :delete, 
                      class: "btn btn-sm btn-outline-danger",
                      form: { class: "d-inline" },
                      data: { confirm: "Are you sure?" } %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted mb-0">No debits recorded yet.</p>
    <% end %>
  </div>
</div>
<%# Add New Overtime Card %>
<div class="card mb-4">
  <div class="card-header">
    <h4 class="card-title mb-0">Add New Overtime</h4>
  </div>
  <div class="card-body">
    <%= form_with(model: [@employee, Overtime.new], local: true, class: "row g-3") do |f| %>
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-text">Hours</span>
          <%= f.number_field :hours_value, step: :any, class: "form-control", placeholder: "Enter number of hours" %>
        </div>
      </div>
      <div class="col-12">
        <%= f.label :Date, class: "form-label" %>
        <%= f.date_select :time, { order: [:day, :month, :year] },class: "form-select"  %>
      </div>
      <div class="col-12">
        <%= f.submit 'Add Overtime', class: "btn btn-sm btn-outline-primary" %>
      </div>
    <% end %>
  </div>
</div>
<%# Overtime History Card %>
<div class="card mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h4 class="card-title mb-0">Overtime History</h4>
    <span class="badge badge-pill bg-info">Total: <%= @employee.overtimes.sum(:hours_value) %> Hours</span>
    <span class="badge badge-pill bg-info">Total:<%= number_to_currency(@employee.overtime_value, unit: " SAR ") %></span>
  </div>
  <div class="card-body">
    <% if @employee.overtimes.any? %>
      <div class="row">
        <% @employee.overtimes.each do |overtime| %>
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title"><%= overtime.hours_value %> Hours</h5>
                <p class="card-text">Overtime date: <%= overtime.time.strftime("%B %d, %Y") %></p>
                <small class="text-muted">Added on: <%= overtime.created_at.strftime("%B %d, %Y") %>
                  <% if overtime.updated_at!= overtime.created_at %><br>
                    Updated on: <%= overtime.updated_at.strftime("%B %d, %Y") %>
                  <% end %></small>
                <div class="d-flex gap-2 mt-2">
                  <%= link_to 'Edit', edit_employee_overtime_path(@employee, overtime), 
                      class: "btn btn-sm btn-outline-primary" %>
                  <%= button_to 'Delete', employee_overtime_path(@employee, overtime), 
                      method: :delete, 
                      class: "btn btn-sm btn-outline-danger",
                      form: { class: "d-inline" },
                      data: { confirm: "Are you sure?" } %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted mb-0">No overtimes recorded yet.</p>
    <% end %>
  </div>
</div>
<%# Action Buttons %>
<div class="card mb-4">
  <div class="card-body">
    <div class="d-flex gap-2">
      <%= link_to "Edit Employee", edit_employee_path(@employee), 
          class: "btn btn-sm  btn-outline-secondary" %>
      <%= link_to "Back to Employees", employees_path, 
          class: "btn btn-sm  btn-outline-primary" %>
      <%= button_to "Delete Employee", @employee, 
          method: :delete, 
          class: "btn btn-sm  btn-outline-danger ms-auto",
          data: { confirm: "Are you sure you want to delete this employee?" } %>
    </div>
  </div>
</div>