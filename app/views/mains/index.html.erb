<div class="container my-4">

  <!-- Notifications -->
  <% if notice %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= notice %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <% if alert %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= alert %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <!-- Filters -->
  <div class="filter-wrapper bg-white border rounded p-3 mb-4">
    <h5 class="text-center text-primary mb-3">
      <i class="bi bi-calendar-check me-2"></i>Filter Data
    </h5>
    <%= form_tag mains_path, method: :get, class: 'filter-form row g-2 justify-content-center' do %>
      <div class="col-md-4">
        <%= select_tag :year, 
            options_for_select(@years, @current_year), 
            class: 'form-select form-select-sm', 
            prompt: 'Select Year', 
            onchange: 'this.form.submit()' %>
      </div>
      <div class="col-md-4">
        <%= select_tag :month, 
            options_for_select((1..12).map { |m| [Date::MONTHNAMES[m], m] }, @current_month), 
            class: 'form-select form-select-sm', 
            prompt: 'Select Month', 
            onchange: 'this.form.submit()' %>
      </div>
    <% end %>
  </div>

  <!-- Employee Table -->
  <h5 class="text-center mb-4">Employee Table for: <%= @current_year %> <%= Date::MONTHNAMES[@current_month] %></h5>
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead>
        <tr class="table-primary text-center">
          <th>
            <%= check_box_tag 'select_all', 1, false, id: 'select-all', class: 'form-check-input' %>
          </th>
          <th>NO</th>
          <th>Name</th>
          <th>Basic Salary</th>
          <th>Allowance</th>
          <th>Total Salary</th>
          <th>Debits</th>
          <th>Overtime</th>
          <th>Net Salary</th>
          <th>Comment</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% counter = 1 %>
        <% @mains.each do |main| %>
          <tr>
            <td class="text-center">
              <% if main.fully_paid? %>
                <span class="badge bg-success">Paid</span>
              <% else %>
                <%= check_box_tag 'main_id[]', main.id, false, class: 'main-checkbox form-check-input' %>
              <% end %>
            </td>
            <td class="text-center"><%= counter %></td>
            <td><%= main.name %></td>
            <td><%= number_to_currency(main.salary, unit: "SAR ") %></td>
            <td><%= number_to_currency(main.allowance, unit: "SAR ") %></td>
            <td><%= number_to_currency(main.gross_salary, unit: "SAR ") %></td>
            <td><%= number_to_currency(main.total_debits, unit: "SAR ") %></td>
            <td><%= number_to_currency(main.net_overtime, unit: "SAR ") %></td>
            <td><%= number_to_currency(main.total_salary, unit: "SAR ") %></td>
            <td class="text-truncate" style="max-width: 150px;"><%= main.comment %></td>
            <td>
              <%= link_to 'Show', main, class: "btn btn-sm btn-outline-primary me-2" %>
              <%= link_to 'Edit', edit_main_path(main), class: "btn btn-sm btn-outline-primary me-2" %>
            </td>
          </tr>
          <% counter += 1 %>
        <% end %>
      </tbody>
      <tfoot>
        <tr class="table-secondary fw-bold">
          <th>-</th>
          <th>Total</th>
          <td class="text-center">-</td>
          <td><%= number_to_currency(@mains.sum(&:salary), unit: "SAR ") %></td>
          <td><%= number_to_currency(@mains.sum(&:allowance), unit: "SAR ") %></td>
          <td><%= number_to_currency(@mains.sum(&:gross_salary), unit: "SAR ") %></td>
          <td><%= number_to_currency(@mains.sum(&:total_debits), unit: "SAR ") %></td>
          <td><%= number_to_currency(@mains.sum(&:overtime_value), unit: "SAR ") %></td>
          <td><%= number_to_currency(@mains.sum(&:total_salary), unit: "SAR ") %></td>
          <td class="text-center">-</td>
          <td class="text-center">-</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
